#################################################################################################
new project -> projectform versioncontrol : 깃업의 소스를 다운받아서 사용가능

초반에 빈구성 하는데 오래걸린다(loadon1)

동적으로 빈을 만들고 구성하는게 어렵다 동적으로 만들면 다시 재구성해야해서

*HiddenHttpMethodFilter
-과거 put이없을때 input 히든으로 보내면 이게 풋이야라는걸 알게 해줬던거

*componentScan : 특정 패키지 또는 클래스 내부의 stereo type bean을 생성하기위한것
	-ster
	-basePackagesClasses  : 패키지로 쓰면 오타날수도 있어서 해당기능을 사용할것을 권장함
		-marker interface : 하는역할없이 기준만 찍어줌  : Base 
		-해당 인터페이스를 기준패키지를 아래로 다 뒤진다. 

*excludeFilters : 제외 시키는 것
	excludeFilters = { @ComponentScan.Filter(Controller.class)})
	Contoroller 클래스를 제외시켜라
*includeFilters : 포함시키는 것

// stereo type bean
@Controller
@Service
@Repository
@Component

*default servlet이란 무엇인가, spring mvc의 defaultservlet은 dispatcher servlet이다.
	톰켓의 defaultServlet이 .do 외의 것을 처리했다
	html css 같은걸 하는게 dispatcher다
	지난주에는 톰켓의  디슾쳐서블릿에게 넘겼고 스프링엠브시에서는 dispatcherservlet이 defaultservlet이 됐다
	근데 결국엔 사실 dispatcher가 톰켓의 defaultservlet에게 위임을 한다
	이러는 이유는 모든 요청을 dispatcher servlet이 처리하게 하기 위해서임
*dispatcher servlet이 생성되어야지 
	-웹관련 

*rootapplication context
	-서블릿컨텍스트가 처음 구성될때 웹고 관련되지 않은 db, resource bundle서브릿이 아니여도
		필터같은데서도 쓸수있다 글너걸 루트어플리케이션에서 처리한다


applicationcontext vs webapplicationcontext
webapplicationcontext: apllicationcontext + servletContext

applicationContext = BeanFactory + a
	BeanFactory
		Bean

rootConfig -> root applicationcontext
webConfig -> servlet

root applicationContext
	servlet applicationContext 	-dispatcherServlet
		db connection bean

#################################################################################################








id
 email name 
userRegister postRegister








package com.nhnacademy.springmvc.controller;

import com.nhnacademy.springmvc.domain.Post;
import com.nhnacademy.springmvc.exception.UserNotFoundException;
import com.nhnacademy.springmvc.repository.PostRepository;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequestMapping("/post")
public class PostController {
    private final PostRepository postRepository;

    public PostController(PostRepository postRepository) {
        this.postRepository = postRepository;
    }

    @ModelAttribute("post")
    public Post getPost(@PathVariable("postId") long postId) {
        return postRepository.getPost(postId);
    }

    // TODO #2: 게시물 조회 구현
    @GetMapping("/{postId}")
    public String viewPost(@ModelAttribute("post") Post post, Model model) {
        model.addAttribute("post", post);
        // ...
        return "postView";
    }

    // TODO #3: 게시물 수정 form 구현
    @GetMapping("/{postId}/modify")
    public String postModifyForm(@ModelAttribute("post") Post post, Model model) {
        model.addAttribute("post", post);
        // ...
        return "postModify";
    }
    
    
    @ExceptionHandler({UserNotFoundException.class})
    public String handleException(Model model, UserNotFoundException ex) {
        model.addAttribute("exception", ex);
        return "error";
    }
}



반갑습니다. 반장 최겸준입니다.
과제는 잘들 하고 계신지요?

엄청난 분량의 주말과제와 특히나 어려웠던 오늘 수업때문에 심적으로나 육체적으로나 많이 힘드실줄 압니다.
사무장님과 적지않은 시간동안 자치활동에 관한 애기와 취업에 관한 얘기를 나누었고 해당 내용중 공유하면 동기들이 기분 좋을만한 소식이 있겠다 싶어서
전달합니다.

지금까지 우리는(나만일수도) 상위 우수자에게 입사 기회가 주어진다고 알고 있었고 상대평가라는 전제하에 치열하게 공부해왔습니다.
하지만 사실은 조금 다르더군요.
실질적으로 부학장님께서 얘기해주셨던 합격기준 그자체가 입사기회의 기준이었습니다.(인증과 기회는 다른 개념)

다시 말해서, 처음에 광고했던 상위 우수자에 대한 기회라는 개념은 크게 존재하지 않고(물론 극상위자에겐 존재할지도 모르겠습니다만) 
절대평가로 이루어진다는 것입니다.
모두가 절대평가에 합격할수도 모두가 떨어질수도 있겠지만 사무장님은 실제 개발자의 역량에 맞으면 합격할수 있다고 얘기해주셨습니다.
이의 요는 다같이 winwin 해야한다는 것이겠죠.

그래서 사무장님이나 다른분께서 공부를 더하라고 면담시에 말씀주시면 반드시 끌고 가서 결국 좋은 결과를 만들게 해주고 싶어서라고 합니다.
끝까지 고생하면 낙이 올듯 합니다.
조금 더 공유하고 알려주고 물어보고 함께해나가는 문화를 만들었으면 좋겠습니다.

감사합니다.

추가로 자치위원들을 선발하고자 합니다.
특정 업무를 얻는 자치위원이 아니라 자치활동에 필요한 업무가 있을때 동기들에게 도움을 주실 분입니다.
지금 당장은 별일이 없지만 차후에 일이 바빠질수도 있고 단체활동시에 도움을 주실 분이라고 생각하면 되겠습니다.
사무장님도 이에 적극 지지해주셨습니다.

개인공부시간때문에 아무도 지원안하실거같지만 지원해주시면 감사하겠습니다.(크게 할일 없을겁니다 ^^)



교수님 반갑습니다. 최겸준 교육생입니다
과제를 하던 중 궁금증이 발생하여 질문드립니다.

registerStudent()메소드에서 ModelAndView를 사용합니다. 이경우엔 redirect보다는 jsp에게 include하기 위함으로
알고있습니다. 하지만 그렇게되면 디스페쳐 서블릿이 직접적으로 처리하는 형식에서 어긋나버립니다.
본인 컨트롤러가 본인과 연결된 jsp가 아닌 다른 컨트롤러가 뻔히 있는데도 그 컨트롤러를 무시하고 jsp직접적으로 출력시키게되면 
이게 frontcontroller 패턴에 부합한가? 에 대한 의문이 생겨서 질문드립니다. 

@PostMapping("/{studentId}/modify")
    public String modifyUser(@ModelAttribute Student student,
//                             @Valid @ModelAttribute StudentModifyRequest,
                             BindingResult bindingResult,
                             Model model) throws StudentNotFoundException {

        studentRepository.modify(student);
        model.addAttribute("student", student);
        if (bindingResult.hasErrors()) {
            throw new ValidationFailedException(bindingResult);
        }

        return "studentView";



webapplicationcontext = applicationContext + servletContext

modelAttribute
value = ""user , binding =false 
















==================================================================

@RestController : restApi만 전체잇는경우 컨트롤에
@Controller + @ResponseBody : 중간중간에 있는경우


package com.nhnacademy.springmvc.controller;

import org.springframework.web.bind.annotation.RestController;

//@RestController
@Controller
//@ResponseBody
public class UserRestController {
    
    public String htmlRendering() {
        
    }
    
    @ResponseBody
    public User json() {
        
    }
}


==================================================================


    @GetMapping("/something")
    public ResponseEntity<User> handle(@PathVariable("UserId") String userId) {
        return ResponseEntity.ok().header("X-123-1111", "e43344").body(userRepository.getUser(userId));
    }

==================================================================


package com.nhnacademy.springmvc.domain;

import lombok.Value;

@Value
public class UserRegisterRequest {
    String id;
    String password;
    int age;

    String name;

}



package com.nhnacademy.springmvc.controller;

import com.nhnacademy.springmvc.domain.User;
import com.nhnacademy.springmvc.domain.UserRegisterRequest;
import com.nhnacademy.springmvc.exception.UserNotFoundException;
import com.nhnacademy.springmvc.repository.UserRepository;
import java.util.Objects;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class UserRestController {
    private final UserRepository userRepository;

    public UserRestController(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @GetMapping("/users/{userId}")
    public User getUser(@PathVariable("userId") String userId) {
        return userRepository.getUser(userId);
    }

    @GetMapping("/something")
    public ResponseEntity<User> handle(@PathVariable("UserId") String userId) {
        return ResponseEntity.ok().header("X-123-1111", "e43344").body(userRepository.getUser(userId));
    }

    @PostMapping("/users")
    @ResponseStatus(HttpStatus.CREATED) //  201
    public void createUser(@RequestBody UserRegisterRequest userRequest) {
        userRepository.addUser(userRequest.getId(),
            userRequest.getPassword(),
            userRequest.getAge(),
            userRequest.getName());
    }
}



서버 돌린 후 

POST http://localhost:8080/users HTTP/1.1
Content-type: application/json

{
  "id": "dongmyo",
  "password": "67890",
  "age": 19,
  "name": "동묘"
}
================================================================================================



package com.nhnacademy.springmvc.config;

import com.nhnacademy.springmvc.controller.ControllerBase;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.ViewResolverRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@EnableWebMvc
@Configuration
@ComponentScan(basePackageClasses = ControllerBase.class)
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.jsp("/WEB-INF/view/", ".jsp");
    }

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addRedirectViewController("/ver1/xxxx", "/ver2/aaa/xxxx");
    }
}













=======================================================================






package com.nhnacademy.springmvc.config;

import com.nhnacademy.springmvc.controller.ControllerBase;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.ViewResolverRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@EnableWebMvc
@Configuration
@ComponentScan(basePackageClasses = ControllerBase.class)
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.jsp("/WEB-INF/view/", ".jsp");
    }

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addRedirectViewController("/ver1/xxxx", "/ver2/aaa/xxxx");

        registry.addViewController("/user2/register").setViewName("userRegister");
        registry.addViewController("/post2/register").setViewName("postRegister");
    }
}







=====================================================================


package com.nhnacademy.springmvc.config;

import com.nhnacademy.springmvc.controller.ControllerBase;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.ViewResolverRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.web.servlet.i18n.LocaleChangeInterceptor;

@EnableWebMvc
@Configuration
@ComponentScan(basePackageClasses = ControllerBase.class)
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.jsp("/WEB-INF/view/", ".jsp");
    }

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addRedirectViewController("/ver1/xxxx", "/ver2/aaa/xxxx");

        registry.addViewController("/user2/register").setViewName("userRegister");
        registry.addViewController("/post2/register").setViewName("postRegister");
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LocaleChangeInterceptor());
        
    }
}

===================================================================



<fmt:setLocale value="${locale}"/>
<fmt:setBundle basename="boardMessage" var="message" scope="session"/>

<fmt:bundle basename="boardMessage">







===================================================================



package com.nhnacademy.springmvc.config;

import com.nhnacademy.springmvc.controller.ControllerBase;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.LocaleResolver;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.ViewResolverRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.web.servlet.i18n.CookieLocaleResolver;
import org.springframework.web.servlet.i18n.FixedLocaleResolver;
import org.springframework.web.servlet.i18n.LocaleChangeInterceptor;

import java.util.Locale;

@EnableWebMvc
@Configuration
@ComponentScan(basePackageClasses = ControllerBase.class)
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.jsp("/WEB-INF/view/", ".jsp");
    }

    // TODO #1: `LocaleResolver` 설정
    @Bean
    public LocaleResolver localeResolver() {
//        return new FixedLocaleResolver(Locale.KOREAN);
        return new CookieLocaleResolver(); // sessionLocale을 하면 밖으로 들어나지 않는다.
    }

    // TODO #2: `LocaleChangeInterceptor` 추가
    //         `locale`이라는 파라미터로 전달된 값으로 locale을 변경.
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LocaleChangeInterceptor());
    }

}
===================================================================










package com.nhnacademy.springmvc;

import com.nhnacademy.springmvc.config.RootConfig;
import com.nhnacademy.springmvc.config.WebConfig;
import javax.servlet.MultipartConfigElement;
import javax.servlet.ServletRegistration;
import org.springframework.core.annotation.Order;
import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

@Order(2)
public class WebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {
    @Override
    protected String[] getServletMappings() {
        return new String[] { "/" };
    }

    @Override
    protected Class<?>[] getRootConfigClasses() {
        return new Class[] { RootConfig.class };
    }

    @Override
    protected Class<?>[] getServletConfigClasses() {
        return new Class[] { WebConfig.class };
    }

    /*
        // TODO #1: @MultipartConfig
        @MultipartConfig(
            location = "/tmp",
            maxFileSize = -1L,
            maxRequestSize = -1L,
            fileSizeThreshold = 1024
        )
     */
//    @Override
//    protected void customizeRegistration(ServletRegistration.Dynamic registration) {
//        MultipartConfigElement multipartConfigElement
//            = new MultipartConfigElement("C:\\IT\\tmp", -1, -1, 1024);
//
//        registration.setMultipartConfig(multipartConfigElement);
//    }
}







package com.nhnacademy.springmvc.config;

import com.nhnacademy.springmvc.controller.ControllerBase;
import java.util.Locale;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.multipart.MultipartResolver;
import org.springframework.web.multipart.commons.CommonsMultipartResolver;
import org.springframework.web.multipart.support.StandardServletMultipartResolver;
import org.springframework.web.servlet.LocaleResolver;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.ViewResolverRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.web.servlet.i18n.FixedLocaleResolver;
import org.springframework.web.servlet.i18n.LocaleChangeInterceptor;

@EnableWebMvc
@Configuration
@ComponentScan(basePackageClasses = ControllerBase.class)
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.jsp("/WEB-INF/view/", ".jsp");
    }

    @Bean
    public LocaleResolver localeResolver() {
        return new FixedLocaleResolver(Locale.KOREAN);
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LocaleChangeInterceptor());
//        registry.addInterceptor(new MeasuringInter());
    }

    // TODO #2: MultipartResolver 빈 설정
    @Bean
    public MultipartResolver multipartResolver() {
//        return new StandardServletMultipartResolver();
        CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver();
        multipartResolver.setMaxUploadSize(-1);
        return multipartResolver;
    }

    // TODO #3: upload form 설정
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/upload").setViewName("upload");

    }
}

===================================================================

http://localhost:8080/thymeleaf
http://localhost:8080/thymeleaf?locale=en

===================================================================


<!--    <a href="?locale=ko"> <b th:if="${#locale.toString() == 'ko'}">ko</b></a><br />-->
<!--    <a href="?locale=en"> <b th:if="${#locale.toString() == 'en'}">ko</b></a><br />-->

    <a href="?locale=ko">
        <b th:if="${#locale.toString() == 'ko'}">ko</b>
<span th:unless="${#locale.toString() == 'ko'}">ko</span>
    </a><br />
    <a href="?locale=en"> 
<b th:if="${#locale.toString() == 'en'}">ko</b>
</a><br />
<!--    <a href="?locale=en">en</a><br />-->





@Controller
public class HomeController {
    @GetMapping("/")
    public String index() {
        return "thymeleaf/index";
    }

}
    <th:block th:if="">

    </th:block>

===================================================================



깃교수님꺼 내가쓰다가 저장하고 따로 컴퓨터에 두는법
fetch하면 stash도 사라지는지
a href 경로도 궁금
img src 를 항상 classes 안이여야하는지









<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>

<html>
<head>
    <meta charset="UTF-8" />
    <title>학생 정보 조회</title>
</head>
<body>
    이름: ${student.name}<br />
    이메일: ${student.email}<br />
    <c:if test="${!hideScore.equals('yes')}">
        성적: ${student.score}<br />
        평가: ${student.comment}<br />
    </c:if>
    <br />
    <a href="login.html" th:href="@{user/login.html}">login</a>
<a href="/student/ th:href="${student.id}"/modify">정보 수정</a><br />
</body>
</html>





<%@ page contentType="text/html;charset=UTF-8" language="java" %>

<html>
<head>
    <meta charset="UTF-8"/>
    <title>학생 정보 수정</title>
</head>
<body>
<form method="post" action="/student/${student.id}/modify">
    이름: <input type="text" name="name" value="${student.name}"/><br/>
    이메일: <input type="text" name="email" value="${student.email}"/><br/>
    성적: <input type="text" name="score" value="${student.score}"/><br/>
    평가: <textarea name="comment" rows="10" cols="80">${student.comment}</textarea><br/>
    <br/>
    <input type="submit"/>
</form>

</body>
</html>






<a href="?locale=ko" th:with="isLocaleKo=${#locale.toString() == 'ko'">
    <b th:if="${#isLocaleKo}">ko</b>
    <span th:unless="${#isLocaleKo}">ko</span></a><br />
<a href="?locale=en" th:with="isLocaleEn=${#locale.toString() == 'en'">
    <b th:if="${#isLocaleEn}">en</b>
    <span th:unless="${#lisLocaleEn}">en</span></a><br />











<a href="?locale=ko" th:with="isLocaleKo=${#locale.toString() eq 'ko'}">
    <b th:if="${#locale.toString() eq 'ko'}">ko</b>
    <span th:unless="${#locale.toString() eq 'ko'}">ko</span>
</a><br />
<a href="?locale=en" th:with="isLocaleEn=${#locale.toString() eq 'en'}">
    <b th:if="${#locale.toString() eq 'en'}">en</b>
    <span th:unless="${#locale.toString() eq 'en'}">en</span>
</a><br />













===================================================================











0504









===================================================================









1)value -> myValue : 값불러오는법 데모
2)value2 : 1교시 마치기전 실습 파일업로드
	-입력폼 url : /upload


===================================================================

contentNegotiation
accept header를 보고 결정할것인지
특정 parameter값을 보고 결정할것인지
	-parameter값을보고 contentNego가 설정한 형식으로 리스폰스바디를 바로보냄

/users/12345.json -> 듀플리케이티드됨
/users/12345?format=json
/users/12345?format=xml

web service
	SimpleOAP(SOAP)		
	XML	
	json
git checkout contentnegotiation


-json을 위한 라이브러리(직렬역직렬)
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
            <version>2.13.2.2</version>
        </dependency>

-xml을 위한 라이브러리(직렬역질렬)
        <dependency>
            <groupId>com.fasterxml.jackson.dataformat</groupId>
            <artifactId>jackson-dataformat-xml</artifactId>
            <version>2.11.1</version>
        </dependency>

#MemberController
http://localhost:8080/members/admin
http://localhost:8080/members/admin?format=xml
contentNegotiation branch


http://localhost:8080/members/admin
http://localhost:8080/members/admin?format=xml
+
http://localhost:8080/members/admin?format=html도 가능하게 하는법
아래꺼만 해서 안으로 들어가면됨 params를 이용하는 아이디어

package com.nhnacademy.springmvc.controller;

import com.nhnacademy.springmvc.domain.User;
import com.nhnacademy.springmvc.repository.UserRepository;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

@Controller
public class MemberViewController {
    private final UserRepository userRepository;

    public MemberViewController(UserRepository userRepository) {
        this.userRepository = userRepository;
    }


    @GetMapping(value = "/members/{memberId}", params = "format=html")
    public String getMemberView(@PathVariable("memberId") String memberId, Model model) {
        User user = userRepository.getUser(memberId);

        model.addAttribute("user", user);
        return "userInfo";
    }
}


===================================================================

mockmvc branch

package com.nhnacademy.springmvc.controller;

import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.mock;

import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.cookie;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;

import com.nhnacademy.springmvc.repository.UserRepository;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpSession;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;

public class LoginControllerTest {
    private MockMvc mockMvc;

    private UserRepository userRepository;

    @BeforeEach
    void setUp() {
        userRepository = mock(UserRepository.class);
        LoginController loginController = new LoginController(userRepository);
        mockMvc = MockMvcBuilders.standaloneSetup(loginController).build();
    }

    @Test
    void getLoginWithoutCookie() throws Exception {
        mockMvc.perform(get("/login"))
            .andExpect(status().isOk())
            .andExpect(view().name("loginForm"));
        //            .cookie(new Cookie("SESSION", "12345"))


    }

    @Test
    void getLoginWithCookie() throws Exception {


        MvcResult mvcResult =mockMvc.perform(get("/login")
            .cookie(new Cookie("SESSION", "12345")))
            .andExpect(status().isOk())
            .andExpect(view().name("loginForm"))
            .andReturn();
        //            .cookie(new Cookie("SESSION", "12345"))

//        String sessionId = (String) mvcResult.getModelAndView().getModel().
//        assertThat(sessionId).isEqualTo("12345");
    }

    @Test
    void testDoLoginWhenLoginIsSuccessful() throws Exception {
        when(userRepository.matches(anyString(), anyString())).thenReturn(true);

        MvcResult mvcResult = mockMvc.perform(post("/login")
            .param("id", "admin")
            .param("pwd", "12345"))
            .andExpect(status().isOk())
            .andExpect(view().name("loginSuccess"))
            .andExpect(cookie().exists("SESSION"))
            .andReturn();

        HttpSession session = mvcResult.getRequest().getSession(false);
        assertThat(session).isNotNull();

        Cookie cookie = mvcResult.getResponse().getCookie("SESSION");
        assertThat(cookie).isNotNull();
        assertThat(cookie.getValue()).isEqualTo(session.getId());

        String attributeId = mvcResult.getModelAndView().getModelMap()
            .get("id");
        assertThat(attributeId).isEqualTo(session.getId());
    }
}















main
Element 


public static void main() {
	sout("hi");
}	





